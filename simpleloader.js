let newWin = open()
let newScript = newWin.document.createElement('script');
newScript.text = 'eval(\'const roomID=prompt("Enter the room ID"),roomPassword=prompt("Enter the room password");connect();var eventList=[],moveMouse={},lastMouse={x:.5,y:.5},downKeys=[],countWithoutMessages=0,killed=!1,mouseMode="normal",lastMsg=Date.now();function scale(e,t,o,n,s){return(e-t)*(s-n)/(o-t)+n}function checkValidEvent(){return!!(lastMouse.x>=0)&&!!(lastMouse.x<=1)&&!!(lastMouse.y>=0)&&!!(lastMouse.y<=1)}function styleButton(e){return e.style.position="absolute",e.style.scale="2",e.style.zIndex="-1",e}function connect(){let e=new WebSocket("wss://remote-connections-klmik.ondigitalocean.app/room/"+roomID+"/"+roomPassword);e.onopen=t=>{setInterval(function(t){++countWithoutMessages>50&&!killed&&(document.body.innerHTML="<h1>Server has stopped responding temporarily</h1>"),e.readyState==WebSocket.OPEN&&(e.send(JSON.stringify({mouse:moveMouse,events:eventList})),eventList=[],downKeys=[])},100),e.send(JSON.stringify({mouse:moveMouse,events:eventList}))},e.onclose=e=>{killed=!0,document.body.innerHTML="<h1>Server is closed</h1><button>Retry Connection</button>",document.querySelector("body > button").onclick=function(e){document.body.innerHTML="",connect()}},e.onmessage=e=>{countWithoutMessages=0;var t=document.querySelector("body > img");if(document.head.innerHTML=`<title>Unblockable | UPS: ${(1e3/(Date.now()-lastMsg)).toFixed(1)}</title>`,lastMsg=Date.now(),t)t.src=`data:image/png;base64,${e.data}`;else{document.body.innerHTML=`<img src="data:image/png;base64,${e.data}" />`;let o=document.createElement("button");o.innerHTML="Windows",(o=styleButton(o)).id="windows",o.style.top="15",o.style.right="40",o.onclick=function(e){eventList.push({type:"key",action:"click",extra:"win"})},document.body.appendChild(o);let n=document.createElement("button");n.innerHTML="F11",(n=styleButton(n)).id="f11",n.style.top="60",n.style.right="25",n.onclick=function(e){eventList.push({type:"key",action:"click",extra:"f11"})},document.body.appendChild(n);let s=document.createElement("button");s.innerHTML="First Person",(s=styleButton(s)).id="firstPerson",s.style.top="105",s.style.right="50",s.onclick=function(e){mouseMode="normal"==mouseMode?"firstperson":"normal"},document.body.appendChild(s),(t=document.querySelector("body > img")).style.maxWidth="100%",t.style.maxHeight="100%",t.style.left="0px",t.style.top="0px",t.style.position="absolute"}},e.addEventListener("error",e=>{console.log("WebSocket error: ",e)})}document.ondragstart=function(e){return!1},document.oncontextmenu=function(e){return!1},document.onmousemove=function(e){var t={x:e.clientX,y:e.clientY},o=document.querySelector("body > img");if(o){var n=scale(t.x-o.x,0,o.width,0,1),s=scale(t.y-o.y,0,o.height,0,1);"normal"==mouseMode&&n>=0&&n<=1&&s>=0&&s<=1?moveMouse={x:n,y:s}:"firstperson"==mouseMode&&n>=0&&n<=1&&s>=0&&s<=1&&(moveMouse={x:(n-lastMouse.x)*50+.5,y:(s-lastMouse.y)*50+.5}),lastMouse={x:n,y:s}}},document.onmousedown=function(e){checkValidEvent()&&eventList.push({type:"mouse",action:"down",extra:e.which})},document.onmouseup=function(e){checkValidEvent()&&eventList.push({type:"mouse",action:"up",extra:e.which})},document.onkeydown=function(e){checkValidEvent()&&(e.key in downKeys||(eventList.push({type:"key",action:"down",extra:e.key}),downKeys.push(e.key)))},document.onkeyup=function(e){checkValidEvent()&&eventList.push({type:"key",action:"up",extra:e.key})};\')'
newWin.document.body.appendChild(newScript)
